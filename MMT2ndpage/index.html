<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        xintegrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNE-M2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Space+Grotesk:wght@300..700&display=swap"
        rel="stylesheet">

    <!-- GSAP Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <!-- Combined CSS Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400..900;1,400..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&display=swap');

        :root {
            --background-color: #141414;;
            --border-color: rgba(118, 115, 115, 0.191);
        }

        section {
            padding: 2rem;
            background-color: #222;
        }

        body {
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0px;
            overflow: hidden;
            /* Added to prevent scrollbars during animation */
        }

        * {
            box-sizing: border-box;
            font-family: "Alegreya";
        }

        img {
            height: 100%;
            width: 100%;
            object-fit: cover;
        }

        #trailer {
            height: 12px;
            width: 12px;
            background-color: white;
            border-radius: 10px;
            position: fixed;
            left: 0px;
            top: 0px;
            z-index: 10000;
            pointer-events: none;
            opacity: 0px;
            transition: opacity 500ms ease;
        }

        body:hover>#trailer {
            opacity: 1;
        }

        h1,
        h2,
        h3,
        a,
        p,
        span {
            font-family: "Space Grotesk", sans-serif;
            font-weight: bold;
            color: rgba(255, 255, 255);
            margin: 0px;
        }

        p {
            line-height: 2.5rem;
            letter-spacing: 2px;
            font-weight: 500;
            font-family: "Open Sans", sans-serif;
        }

        h2 {
            color: white;
            font-size: 1rem;
            font-family: "Space Grotesk", sans-serif;
            user-select: none;
        }

        a {
            text-decoration: none;
        }

        /* --- NAV STYLES --- */
        /* Nav bar */

        nav {
        position: sticky;
        top: 0;
        width: 100vw;
        padding: 2.5em; 
        height: 0; 
        z-index: 101; 
        
        }

        nav > .logo, 
        nav > .menu-toggle {
            position: relative; 
            top: 2.5em; 
            left: 2.5em; 
        }

        nav {
        position: sticky;
        top: 0;
        width: 100vw;
        padding: 0; 
        height: 0; 
        z-index: 101;
        }
        nav:before {
            content: '';
            display: block;
            padding-top: 2.5em; 
            padding-bottom: 2.5em; }

        /* Reposition the menu content using absolute positioning */
        nav > .logo {
            position: absolute;
            top: 2.5em;
            left: 2.5em;
        }

        nav > .menu-toggle {
            position: absolute;
            top: 2.5em;
            right: 2.5em; 
        }

        a, p{
        position: relative;
        text-decoration: none;
        color: black;
        font-size: 1rem;
        font-weight: 500;
        user-select: none;
        text-transform: uppercase;
        }

        .white_text{
        position: relative;
        text-decoration: none;
        color: white;
        font-size: 1rem;
        font-weight: 500;
        user-select: none;
        text-transform: uppercase;
        }

        .socials.white_text a {
        color: white;
        }

        .logo a{
        font-weight: 600;
        }

        .menu-toggle{
        position: relative;
        width: 3rem;
        height: 1.5rem;
        cursor: pointer;
        }

        .menu-toggle p{
        position: absolute;
        transform-origin: top left;
        will-change: transform, opacity;
        }

        .menu-overlay{
        position: fixed;
        width: 100vw;
        height: 100svh;
        z-index: 1; /* Shader Disabled here... */
        }

        .menu-content{
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        transform-origin: left bottom;
        will-change: transform, opacity;
        }

        .menu-items, .menu-footer{
        width: 100%;
        padding: 2.5em;
        display: flex;
        gap: 2.5em;
        }

        .col-lg{
        flex: 3;
        }

        .col-sm{
        flex: 2;
        }

        .menu-items .col-lg{
        display: flex;
        justify-content: center;
        align-items: center;
        }

        .menu-preview-img{
        position: relative;
        width: 45%;
        height: 100%;
        overflow: hidden;
        }

        .menu-preview-img img{
        position: absolute;
        will-change: transform, opacity;
        }

        .menu-items .col-sm{
        padding: 2.5em 0;
        display: flex;
        flex-direction: column;
        gap: 2.5em;
        }

        .menu-links, .menu-socials{
        display: flex;
        flex-direction: column;
        gap: 0.5em;
        }

        .link, .social{
        padding-bottom: 6px;
        clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%);
        }

        .link a, .social a{
        display: inline-block;
        will-change: transform;
        transition: color 0.5s;
        }

        .link a{
        font-size: 3.5em;
        letter-spacing: -0.02rem;
        }

        .social a{
        color: #8f8f8f;
        }

        .social a:hover{
        color: #fff;
        }

        .menu-footer{
        position: absolute;
        bottom: 0;
        }

        .menu-footer .col-sm{
        display: flex;
        justify-content: space-between;
        }

        .link a::after,
        .social a::after,
        .menu-footer a::after{
        position: absolute;
        content: "";
        top: 102.5%;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #fff;
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.3s cubic-bezier(0.6,0,0.4,1);
        }

        .link a:hover::after,
        .social a:hover::after,
        .menu-footer a:hover::after{
        transform: scaleX(1);
        transform-origin: left;
        }


        .container{ /* !!! */
        position: relative;
        width: 100%;
        height: 100%;
        will-change: transform;
        transform-origin: right top;
        }

        .hero3{
        position: relative;
        width: 100vw;
        height: 100svh;
        padding: 2.5em;
        display: flex;
        align-items: flex-end;
        overflow: hidden;
        }

        .hero-img{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100svh;
        z-index: -1;
        }

        .hero h3{
        width: 80%;
        }

        .menu-toggle p#menu-close{
        opacity: 0;
        transform: translateX(-5px) translateY(10px) rotate(5deg);
        }

        .link a, .social a{
        transform: translateY(120%);
        opacity: 0.25;
        }

        .menu-content{
        transform: translateX(-100px) translateY(-100px) scale(1.5) rotate(-150deg);
        opacity: 0.25;
        }

        .menu-overlay{
        clip-path: polygon(0% 0%, 100% 0%, 100% 0%, 0% 0%);
        }

        @media (max-width:900px){
        .hero3 h3{
            width: 100%;
            font-size: 4rem;
            letter-spacing: 0;
        }

        .menu-items .col-lg{
            display: none;
        }

        .link a::after,
        .social a::after,
        .menu-footer a::after{
            display: none;
        }
        }

        main {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        main>article {
            height: 100%;
            width: 100%;
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: 2fr 1fr;
            position: absolute;
            left: 0px;
            top: 0px;
            transition: transform 400ms ease;
        }

        main>article[data-status="inactive"] {
            transform: translateX(-100%);
            transition: none;
        }

        main>article[data-status="active"] {
            transform: translateX(0%);
        }

        main>article[data-status="before"] {
            transform: translateX(-100%);
        }

        main>article[data-status="after"] {
            transform: translateX(100%);
        }

        main>article[data-status="becoming-active-from-before"] {
            transform: translateX(-100%);
            transition: none;
        }

        main>article[data-status="becoming-active-from-after"] {
            transform: translateX(100%);
            transition: none;
        }

        main>article>.article-section {
            height: 100%;
            display: flex;
        }

        main>article>.article-description-section,
        main>article>.article-nav-section {
            border-left: 1px solid var(--border-color);
        }

        main>article>.article-title-section,
        main>article>.article-nav-section {
            border-top: 1px solid var(--border-color);
        }

        main>article:first-child>.article-image-section {
            background-image: url(../public/10.png);
        }


        main>article:nth-child(2)>.article-image-section {
            background-image: url(../public/11.png);
        }


        main>article:nth-child(3)>.article-image-section {
            background-image: url(../public/12.png);
        }

        main>article:nth-child(4)>.article-image-section {
            background-image: url(../public/13.png);
        }


        main>article>.article-image-section {
            background-position: center;
            background-size: cover;
            width: 100%;
            height: 100%;
        }


        main>article>.article-description-section {
            flex-direction: column;
            justify-content: flex-end;
            padding: 4rem;
        }


        main>article>.article-description-section>p {
            color: rgba(255, 255, 255);
            font-size: 1.25em;
        }


        main>article>.article-title-section {
            align-items: center;
            justify-content: space-between;
            padding: 2rem 4rem;
        }


        main>article>.article-title-section * {
            color: white;
        }


        main>article>.article-title-section>h2 {
            flex-basis: 80%;
            font-family: "Space Grotesk", sans-serif;
            font-size: 2.5rem;
            line-height: 4.5rem;
            margin: 0px;
            text-transform: uppercase;
        }


        main>article>.article-title-section>i {
            color: rgba(255, 255, 255, 0.75);
            font-size: 4rem;
        }


        #nav-toggle-button {
            align-items: center;
            background-color: transparent;
            border: none;
            border-left: 1px solid var(--border-color);
            color: white;
            cursor: pointer;
            display: none;
            gap: 0.8rem;
            height: 100%;
            justify-content: center;
            outline: none;
            padding: 0rem 3rem;
            position: relative;
            z-index: 3;
        }


        #nav-toggle-button:hover,
        #nav-toggle-button:hover>span {
            color: var(--highlight-color);
        }


        #nav-toggle-button>span,
        #nav-toggle-button>i {
            display: inline-block;
            height: 1rem;
            line-height: 1rem;
        }


        main>article>.article-nav-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }


        main>article>.article-nav-section>.article-nav-button {
            background-color: transparent;
            flex-grow: 1;
            border: none;
            outline: none;
            color: rgba(255, 255, 255, 0.75);
            font-size: 10rem;
            cursor: pointer;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }


        main>article>.article-nav-section>.article-nav-button>i {
            margin: 0;
            font-size: 5rem;
            color: inherit;
        }


        main>article>.article-nav-section>.article-nav-button:nth-child(2) {
            border-left: 1px solid var(--border-color);
        }


        .glowing-text {
            display: flex;
            gap: 0.4rem;
            margin: 0px;
        }


        .glowing-text span {
            font-family: "Space Grotesk", sans-serif;
            font-size: 2rem;
            font-weight: bold;
            color: rgb(255, 255, 255);
            text-transform: uppercase;
            opacity: 1;
            margin: 0px;
        }


        .glow {
            animation: glow 20s infinite;
        }


        .glow:nth-child(12) {
            animation-delay: 0s;
        }


        .glow:nth-child(13) {
            animation-delay: 0.4s;
        }


        .glow:nth-child(14) {
            animation-delay: 0.8s;
        }


        .glow:nth-child(15) {
            animation-delay: 1.2s;
        }


        .glow:nth-child(16) {
            animation-delay: 1.6s;
        }


        .glow:nth-child(17) {
            animation-delay: 2s;
        }


        .glow:nth-child(18) {
            animation-delay: 2.4s;
        }


        .glow:nth-child(19) {
            animation-delay: 2.8s;
        }


        .glow:nth-child(20) {
            animation-delay: 3.2s;
        }


        .glow.special {
            color: #40e068;
            animation: special-glow 10s infinite alternate;
        }


        @keyframes glow {

            0%,
            100% {
                color: rgba(255, 255, 255, 0.3);
                text-shadow: none;
                transform: scale(1);
            }

            50% {
                color: #40e0d0;
                opacity: 1;
            }
        }

        @keyframes special-glow {
            0% {
                text-shadow: none;
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1.1);
            }
        }


        main>article>.article-nav-section>.article-nav-button:hover {
            background-color: rgba(255, 255, 255, 0.02);
        }


        main>article>.article-nav-section>.article-nav-button:nth-child(2) {
            border-left: 1px solid var(--border-color);
        }


        section#main-content {
            padding: 20px;
            background-color: #f9f9f9;
        }


        section#main-content h2,
        section#main-content h3 {
            margin-top: 0;
            font-size: 2rem;
        }


        section#main-content p {
            line-height: 1.6;
            font-size: 1.1rem;
        }
    </style>
</head>

    <body>

        <div class="menu-overlay">
                <div class="menu-content">
                    <div class="menu-items">
                        <div class="col-lg">
                            <div class="menu-preview-img"><img src="public/beach.jpg" alt="beach"></div>
                        </div>
                        <div class="col-sm">
                            <div class="menu-links">
                                <div class="link">
                                    <a class="white_text" href="../index.html" data-img="../public/1.png">Home</a>
                                </div>
                                <div class="link">
                                    <a class="white_text" href="#" data-img="../public/2.png">About</a>
                                </div>
                                <div class="link">
                                    <a class="white_text" href="../ENGLISHVIDEO.mp4" data-img="../public/3.png">Video (Eng)</a>
                                </div>
                                <div class="link">
                                    <a class="white_text" href="../UPDATEDMAORI.mp4" data-img="../public/4.png">Video (Māori)</a>
                                </div>
                            </div> 
                            <div class="menu-socials">
                                <div class="socials white_text"><a href="https://www.instagram.com/fairy.tern?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==">Claire Greenwell</a></div>
                                <div class="socials white_text"><a href="https://www.nzbirdsonline.org.nz/species/fairy-tern">Codex</a></div>
                                <div class="socials white_text"><a href="https://www.youtube.com/watch?v=WgBwzXzTd34">Youtube</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-footer">
                        <div class="col-lg">
                            <a class="white_text" href="#">Run Sequence</a>
                        </div>
                        <div class="col-sm">
                            <a class="white_text" href="#">Origin</a>
                            <a class="white_text" href="#">Join the Save</a>
                        </div>
                    </div>
                </div>
            </div>

        <nav>
            <div class="menu-toggle">
                <p class="white_text" id="menu-open">Menu</p>
                <p class="white_text" id="menu-close">Close</p>
            </div>
        </nav>


        <div class="container">
            <main>
                <article data-index="0" data-status="active">
                    <div class="article-image-section article-section"></div>
                    <div class="article-description-section article-section">
                        <div class="glowing-text">
                            <span>W</span>
                            <span>E</span>
                            <span>L</span>
                            <span>C</span>
                            <span>O</span>
                            <span>M</span>
                            <span>E</span>
                            <span>&nbsp;</span>
                            <span>T</span>
                            <span>O</span>
                            <span>&nbsp;</span>

                            <span class="glow special">F</span>
                            <span class="glow special">A</span>
                            <span class="glow special">I</span>
                            <span class="glow special">R</span>
                            <span class="glow special">Y</span>
                            <span class="glow special">T</span>
                            <span class="glow special">E</span>
                            <span class="glow special">R</span>
                            <span class="glow special">N</span>
                        </div>
                        <br>
                        <p>
                            The New Zealand Fairy Tern (Sternula nereis davisae) is a subspecies endemic to New Zealand. They are tiny, measuring only about 25 cm long, and are distinguished by their black caps, white undersides, and yellow-orange legs.
                        </p>
                    </div>
                    <div class="article-title-section article-section">
                        <h2>CRITICALLY ENDANGERED: TARA ITI</h2>
                    </div>
                    <div class="article-nav-section article-section">
                        <button class="article-nav-button" type="button" onclick="handleLeftClick()">
                            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                        </button>
                        <button class="article-nav-button" type="button" onclick="handleRightClick()">
                            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </article>
                <article data-index="1" data-status="inactive">
                    <div class="article-image-section article-section"></div>
                    <div class="article-description-section article-section">
                        <p>
                            Fairy Terns historically bred in many parts of the North Island, but now breed at just four main sites: Waipu, Mangawhai, Pākiri, and Papakanui Spit. These sites are intensively managed by conservation staff to ensure successful breeding seasons.
                        </p>
                    </div>
                    <div class="article-title-section article-section">
                        <h2>A FRAGILE HOME ON THE SAND</h2>
                    </div>
                    <div class="article-nav-section article-section">
                        <button class="article-nav-button" type="button" onclick="handleLeftClick()">
                            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                        </button>
                        <button class="article-nav-button" type="button" onclick="handleRightClick()">
                            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </article>
                <article data-index="2" data-status="inactive">
                    <div class="article-image-section article-section"></div>
                    <div class="article-description-section article-section">
                        <p>
                            The Terns usually lay only one or two eggs directly in a shallow scrape on the sand. Their eggs and newly hatched chicks are incredibly vulnerable, with the biggest threats being high tides, storms, and introduced mammalian predators like cats and stoats.
                        </p>
                    </div>
                    <div class="article-title-section article-section">
                        <h2>THE THREATS TO SURVIVAL</h2>
                    </div>
                    <div class="article-nav-section article-section">
                        <button class="article-nav-button" type="button" onclick="handleLeftClick()">
                            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                        </button>
                        <button class="article-nav-button" type="button" onclick="handleRightClick()">
                            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </article>
                <article data-index="3" data-status="inactive">
                    <div class="article-image-section article-section"></div>
                    <div class="article-description-section article-section">
                        <p>
                            DOC staff employ a rigorous system of fencing, pest control, and active management to protect the nests. They also use methods like foster parenting, placing fertile eggs under common terns, to maximize the chance of survival for every chick.
                        </p>
                    </div>
                    <div class="article-title-section article-section">
                        <h2>JOIN THE CONSERVATION EFFORT</h2>
                    </div>
                    <div class="article-nav-section article-section">
                        <button class="article-nav-button" type="button" onclick="handleLeftClick()">
                            <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                        </button>
                        <button class="article-nav-button" type="button" onclick="handleRightClick()">
                            <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </article>
                <button id="nav-toggle" type="button" onclick="toggleNav()"></button>
            </main>
        </div>
    </body>
    <!-- Combined JavaScript -->
    <script>
        let activeIndex = 0;
        const slides = document.getElementsByTagName("article");

        const handleLeftClick = () => {
            const nextIndex = activeIndex - 1 >= 0 ? activeIndex - 1 : slides.length - 1;

            const currentSlide = document.querySelector(`[data-index="${activeIndex}"]`),
                nextSlide = document.querySelector(`[data-index="${nextIndex}"]`);
            currentSlide.dataset.status = "after";

            nextSlide.dataset.status = "becoming-active-from-before";

            setTimeout(() => {
                nextSlide.dataset.status = "active";
                activeIndex = nextIndex;
            });
        }

        const handleRightClick = () => {
            const nextIndex = activeIndex + 1 <= slides.length - 1 ? activeIndex + 1 : 0;

            const currentSlide = document.querySelector(`[data-index="${activeIndex}"]`),
                nextSlide = document.querySelector(`[data-index="${nextIndex}"]`);

            currentSlide.dataset.status = "before";

            nextSlide.dataset.status = "becoming-active-from-after";

            setTimeout(() => {
                nextSlide.dataset.status = "active";
                activeIndex = nextIndex;
            });
        }

        /* -- Mobile Nav Toggle Placeholder -- */
        const nav = document.querySelector("nav");

        const handleNavToggle = () => {
            nav.dataset.transitionable = "true";

            nav.dataset.toggled = nav.dataset.toggled === "true" ? "false" : "true";
        }

        const toggleNav = () => console.log("Nav toggle clicked");


        window.matchMedia("(max-width: 800px)").onchange = e => {
            nav.dataset.transitionable = "false";

            nav.dataset.toggled = "false";
        };


        document.addEventListener("DOMContentLoaded", () => {
            // Register ScrollTrigger plugin (good practice when included)
            gsap.registerPlugin(ScrollTrigger);

            const container = document.querySelector(".container")
            const menuToggle = document.querySelector(".menu-toggle")
            const menuOverlay = document.querySelector(".menu-overlay")
            const menuContent = document.querySelector(".menu-content")
            const menuPreviewImg = document.querySelector(".menu-preview-img")
            const menuLinks = document.querySelectorAll(".link a")

            let isOpen = false;
            let isAnimating = false;

            // *** FIX: Set the consistent initial state using GSAP.set() ***
            // This is the new hidden start position for the menu, replacing the aggressive CSS.
            gsap.set(menuContent, {
                rotation: -15, // Consistent starting rotation (less aggressive than -150)
                x: -100,
                y: -100,
                scale: 1.5,
                opacity: 0.25
            });

            menuToggle.addEventListener("click", () => {
                if (!isOpen) openMenu();
                else closeMenu();
            });

            function cleanupPreviewImages() {
                const previewImages = menuPreviewImg.querySelectorAll("img");
                if (previewImages.length > 0 && previewImages.length - 1 > 0) {
                    for (let i = 0; i < previewImages.length - 1; i++) {
                        menuPreviewImg.removeChild(previewImages[i]);
                    }
                }
            }

            function resetPreviewImage() {
                menuPreviewImg.innerHTML = "";
                const defaultPreviewImg = document.createElement("img");
                defaultPreviewImg.src = "../public/beach.jpg";
                menuPreviewImg.appendChild(defaultPreviewImg);
            }

            function animateMenuToggle(isOpening) {
                const open = document.querySelector("p#menu-open");
                const close = document.querySelector("p#menu-close");

                gsap.to(isOpening ? open : close, {
                    x: isOpening ? -5 : 5,
                    y: isOpening ? -10 : 10,
                    rotation: isOpening ? -5 : 5,
                    opacity: 0,
                    delay: 0.25,
                    duration: 0.5,
                    ease: "power2.out",
                });

                gsap.to(isOpening ? close : open, {
                    x: 0,
                    y: 0,
                    rotation: 0,
                    opacity: 1,
                    delay: 0.5,
                    duration: 0.5,
                    ease: "power2.out",
                });
            }

            function openMenu() {
                if (isAnimating || isOpen) return;
                isAnimating = true;

                // Seamless Peel Animation: Large rotation combined with translation
                gsap.to(container, {
                    rotation: 45,
                    x: -1200,
                    y: 900,
                    scale: 0.7,
                    duration: 1.25,
                    ease: "power4.inOut",
                });

                animateMenuToggle(true);

                // This now animates consistently from the state set by gsap.set()
                gsap.to(menuContent, {
                    rotation: 0,
                    x: 0,
                    y: 0,
                    scale: 1,
                    opacity: 1,
                    duration: 1.25,
                    ease: "power4.inOut",
                });

                gsap.to([".link a", ".social a"], {
                    y: "0%",
                    opacity: 1,
                    duration: 1,
                    delay: 0.75,
                    stagger: 0.1,
                    ease: "power3.out"
                });

                gsap.to(menuOverlay, {
                    clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
                    duration: 1.25,
                    ease: "power4.inOut",
                    onComplete: () => {
                        isOpen = true;
                        isAnimating = false;
                    },
                });
            }

            function closeMenu() {
                if (isAnimating || !isOpen) return;
                isAnimating = true;

                // Return container to original position (reverse of openMenu)
                gsap.to(container, {
                    rotation: 0,
                    x: 0,
                    y: 0,
                    scale: 1,
                    duration: 1.25,
                    ease: "power4.inOut",
                });

                animateMenuToggle(false);

                // Close menu animates back to the consistent starting state
                gsap.to(menuContent, {
                    rotation: -15,
                    x: -100,
                    y: -100,
                    scale: 1.5,
                    opacity: 0.25,
                    duration: 1.25,
                    ease: "power4.inOut",
                });

                gsap.to(menuOverlay, {
                    clipPath: "polygon(0% 0%, 100% 0%, 100% 0%, 0% 0%)",
                    duration: 1.25,
                    ease: "power4.inOut",
                    onComplete: () => {
                        isOpen = false;
                        isAnimating = false;
                        // Set the link initial state for the next open
                        gsap.set([".link a", ".social a"], {
                            y: "120%"
                        });
                        resetPreviewImage();
                    },
                });
            }

            menuLinks.forEach((link) => {
                link.addEventListener("mouseover", () => {
                    if (!isOpen || isAnimating) return;

                    const imgSrc = link.getAttribute("data-img")
                    if (!imgSrc) return;

                    const previewImages = menuPreviewImg.querySelectorAll("img");
                    if (previewImages.length > 0 && previewImages[previewImages.length - 1].src.endsWith(imgSrc)) return;

                    const newPreviewImg = document.createElement("img");
                    // NOTE: Using a placeholder image since public/beach.jpg isn't available
                    newPreviewImg.src = imgSrc;
                    newPreviewImg.style.opacity = "0";
                    newPreviewImg.style.transform = "scale(1.25) rotate(10deg)";

                    menuPreviewImg.appendChild(newPreviewImg);
                    cleanupPreviewImages();

                    gsap.to(newPreviewImg, {
                        opacity: 1,
                        scale: 1,
                        rotation: 0,
                        duration: 0.75,
                        ease: "power2.out"
                    });
                });
            });

            // Set initial state for trailer image
            resetPreviewImage();
        });
    </script>
</body>

</html>
